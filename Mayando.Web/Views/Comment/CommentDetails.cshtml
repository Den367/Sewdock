@model Mayando.Web.Models.Comment
@using System.Globalization
@using Mayando.Web.Extensions
@using Mayando.Web.Infrastructure
@using JelleDruyts.Web.Mvc
@using Mayando.Web.Properties
@{
    Layout = null;
    }
<div id="@Model.Id" class="comment @(Model.AuthorIsOwner ? " comment-owner" : string.Empty)" >
  
    <div class="comment-title">
        @(
    Resources.PhotoCommentsBy)
        <span class="comment-author">@Html.Raw(Html.Link(Model.AuthorUrl, Model.AuthorName, true)) </span>
        <span class="comment-date">@Html.DateTimeText(Model.DatePublished, DateTimeDisplayType.CommentPublished)</span>
        @* @if (Page.User.CanSeeAdministratorContent()) { 
                                    @Html.ActionLinkCommentEdit("Edit", Model.Id, this.Context.Request.RawUrl, "admin")
                                    @Html.ActionLinkCommentDelete("Delete", Model.Id, this.Context.Request.RawUrl, "admin")
                                     } *@
    </div>
    <div class="comment-content">
        <div class="comment-gravatar">
            <img src="@Url.Gravatar(Model.AuthorEmail, 60, Url.ThemedContent("~/content/anonymous.png"))" height="60" width="60" alt="Gravatar" />
        </div>
        @if (User.IsAdministrator() || Model.AuthorIsOwner)
        {
            var routeValues = new RouteValueDictionary();
            routeValues.Add("id", Model.Id.ToString(CultureInfo.InvariantCulture));
            routeValues.Add("embroId", Model.EmbroId.ToString(CultureInfo.InvariantCulture));

            var htmlAttributes = new Dictionary<string, object>();
            htmlAttributes.Add("class","btn");

            var ajaxOptions = new AjaxOptions
                {
                    Url = Url.Action("Delete", "Comment", routeValues),
                    OnSuccess = "hideDeletedComment"                                            
                };
            @Ajax.ActionLink(Resources.ButtonDeleteText, "Delete", "Comment", routeValues,ajaxOptions, htmlAttributes );                                          
        }
 
        <div class="comment-text">@Html.EncodeWithLineBreaks(Model.Text)</div>
    </div>
</div>
<script type="text/javascript"> 
    
    function hideDeletedComment(result) {
        var path = "table.list div#" + result.id;       
        $(path).hide('slow');       
    }
</script>
